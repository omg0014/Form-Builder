<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Form Builder</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      transition: background-color 0.3s, color 0.3s;
    }
    body.light {
      background-color: #f9fafb;
      color: #1f2937;
    }
    body.dark {
      background-color: #1f2937;
      color: #93c5fd;
    }
    body.dark .form-preview {
      background-color: #374151;
      color: #93c5fd;
    }
    .field-card {
      padding: 1rem;
      background-color: #ffffff;
      border-radius: 0.5rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
      margin-bottom: 0.75rem;
    }
    body.dark .field-card {
      background-color: #1f2937;
    }
    .template-contact {
      background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
      border-left: 6px solid #3b82f6;
      color: #1e40af;
      padding: 1rem 1.5rem;
      border-radius: 0.5rem;
    }
    .template-feedback {
      background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
      border-left: 6px solid #22c55e;
      color: #166534;
      padding: 1rem 1.5rem;
      border-radius: 0.5rem;
    }
    .template-registration {
      background: linear-gradient(135deg, #ede9fe 0%, #c4b5fd 100%);
      border-left: 6px solid #8b5cf6;
      color: #5b21b6;
      padding: 1rem 1.5rem;
      border-radius: 0.5rem;
    }
    .template-survey {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-left: 6px solid #eab308;
      color: #854d0e;
      padding: 1rem 1.5rem;
      border-radius: 0.5rem;
    }
    .copy-link-box {
      margin-top: 0.5rem;
      padding: 0.5rem 1rem;
      background-color: #e0e7ff;
      border: 1px solid #3b82f6;
      border-radius: 0.375rem;
      font-family: monospace;
      word-break: break-word;
      user-select: all;
      color: #1e40af;
    }
    body.dark .copy-link-box {
      background-color: #4338ca;
      border-color: #a5b4fc;
      color: #e0e7ff;
    }
    button {
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    button:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
    }
    button:active {
      transform: scale(0.97);
      filter: brightness(0.95);
    }
    button:focus {
      outline: 2px solid #3b82f6;
      outline-offset: 2px;
    }
  </style>
</head>
<body class="light">
  <div class="p-4 flex justify-between flex-wrap gap-2">
    <h1 class="text-2xl font-bold">Form Builder</h1>
    <div class="flex gap-2">
      <button id="themeToggle" class="px-4 py-2 bg-gray-700 text-white rounded">Toggle Theme</button>
    </div>
  </div>
  <div id="root" class="p-4"></div>
<script type="text/babel">
  const { useState, useEffect, useRef } = React;

  function App() {
    const urlParams = new URLSearchParams(window.location.search);
    const mode = urlParams.get('mode'); // 'preview' or 'edit' or null
    const formId = urlParams.get('id');

    const [history, setHistory] = useState({
      past: [],
      present: [],
      future: [],
    });
    const [templateClass, setTemplateClass] = useState('');
    const [formBg] = useState(localStorage.getItem('formBg') || '');
    const isPreview = mode === 'preview' || (mode !== 'edit' && !!formId);
    const [copiedLink, setCopiedLink] = useState('');
    const { past, present: fields, future } = history;

    // refs to form inputs for clearing on submit
    const formRef = useRef(null);

    useEffect(() => {
      document.body.className = localStorage.getItem('theme') || 'light';
    }, []);

    useEffect(() => {
      if (formId) {
        const savedForm = localStorage.getItem(formId);
        if (savedForm) {
          setHistory({ past: [], present: JSON.parse(savedForm), future: [] });
        }
      } else {
        if (!isPreview) {
          const saved = localStorage.getItem('formFields');
          if (saved) {
            setHistory({ past: [], present: JSON.parse(saved), future: [] });
          }
        }
      }
    }, [formId]);

    useEffect(() => {
      if (!isPreview) {
        localStorage.setItem('formFields', JSON.stringify(fields));
      }
    }, [fields]);

    function setFields(newFields) {
      setHistory({
        past: [...past, fields],
        present: newFields,
        future: [],
      });
    }

    function undo() {
      if (past.length === 0) return;
      const previous = past[past.length - 1];
      const newPast = past.slice(0, past.length - 1);
      setHistory({
        past: newPast,
        present: previous,
        future: [fields, ...future],
      });
    }

    function redo() {
      if (future.length === 0) return;
      const next = future[0];
      const newFuture = future.slice(1);
      setHistory({
        past: [...past, fields],
        present: next,
        future: newFuture,
      });
    }

    useEffect(() => {
      const handleKey = (e) => {
        if (e.ctrlKey && e.key === 'z') undo();
        if (e.ctrlKey && e.key === 'y') redo();
      };
      window.addEventListener('keydown', handleKey);
      return () => window.removeEventListener('keydown', handleKey);
    }, [past, future]);

    function addField(type) {
      const id = Date.now();
      setFields([...fields, { id, type, label: '', placeholder: '', required: false, min: '', max: '', options: '' }]);
    }

    function updateField(id, changes) {
      setFields(fields.map(f => (f.id === id ? { ...f, ...changes } : f)));
    }

    function deleteField(id) {
      setFields(fields.filter(f => f.id !== id));
    }

    function applyTemplate(template) {
      const templates = {
        contact: [
          { id: 1, type: 'Text', label: 'Name', placeholder: 'Enter your name', required: true },
          { id: 2, type: 'Text', label: 'Email', placeholder: 'Enter your email', required: true },
          { id: 3, type: 'Textarea', label: 'Message', placeholder: 'Your message', required: true },
        ],
        feedback: [
          { id: 4, type: 'Text', label: 'Full Name', placeholder: '', required: true },
          { id: 5, type: 'Textarea', label: 'Feedback', placeholder: '', required: true },
        ],
        registration: [
          { id: 6, type: 'Text', label: 'First Name', required: true },
          { id: 7, type: 'Text', label: 'Last Name', required: true },
          { id: 8, type: 'Date', label: 'DOB', required: true },
        ],
        survey: [
          { id: 9, type: 'Text', label: 'Age', required: true },
          { id: 10, type: 'Textarea', label: 'Opinion', required: false },
        ],
      };
      setFields(templates[template]);
      setTemplateClass(`template-${template}`);
    }

    function onSubmit(e) {
      e.preventDefault();
      alert('Form submitted successfully!');
      // Clear all input fields in the form
      if (formRef.current) {
        formRef.current.reset();
      }
    }

    function generateLink() {
      const id = 'form_' + Date.now();
      localStorage.setItem(id, JSON.stringify(fields));
      const url = `${window.location.origin}${window.location.pathname}?mode=preview&id=${id}`;
      navigator.clipboard.writeText(url);
      setCopiedLink(url);
    }

    const handleDrop = (e) => {
      e.preventDefault();
      let type = e.dataTransfer.getData('fieldType');
      if (!type && e.target?.dataset?.fieldType) {
        type = e.target.dataset.fieldType;
      }
      if (type) addField(type);
    };

    const allowDrop = (e) => e.preventDefault();

    const fieldTypes = ['Text', 'Textarea', 'Date', 'Dropdown', 'Checkbox'];

    return (
      <div className="max-w-2xl mx-auto">
        {!isPreview && (
          <>
            <div className="flex flex-wrap gap-2 mb-4">
              {fieldTypes.map(ft => (
                <button
                  key={ft}
                  draggable
                  onDragStart={e => e.dataTransfer.setData('fieldType', ft)}
                  onTouchStart={e => e.currentTarget.dataset.fieldType = ft}
                  className="bg-blue-600 text-white px-3 py-1 rounded"
                >
                  Add {ft}
                </button>
              ))}
            </div>

            <div className="mb-4 flex gap-2 flex-wrap">
              <button onClick={() => applyTemplate('contact')} className="template-contact">Contact Form</button>
              <button onClick={() => applyTemplate('feedback')} className="template-feedback">Feedback Form</button>
              <button onClick={() => applyTemplate('registration')} className="template-registration">Registration Form</button>
              <button onClick={() => applyTemplate('survey')} className="template-survey">Survey Form</button>
            </div>

            <div
              className={`p-4 rounded shadow ${formBg} min-h-[200px]`}
              onDrop={handleDrop}
              onDragOver={allowDrop}
              onTouchMove={allowDrop}
            >
              {fields.length === 0 && (
                <p className="text-gray-400">Drag and drop a field here or click buttons above</p>
              )}
              {fields.map(field => (
                <div
                  key={field.id}
                  className="field-card flex flex-col"
                  draggable
                  onDragStart={e => e.dataTransfer.setData('fieldId', field.id)}
                  onTouchStart={e => e.currentTarget.dataset.fieldId = field.id}
                >
                  <input
                    className="border rounded p-1 mb-1"
                    type="text"
                    placeholder="Label"
                    value={field.label}
                    onChange={e => updateField(field.id, { label: e.target.value })}
                  />
                  {field.type === 'Dropdown' && (
                    <input
                      className="border rounded p-1 mb-1"
                      type="text"
                      placeholder="Options comma separated"
                      value={field.options || ''}
                      onChange={e => updateField(field.id, { options: e.target.value })}
                    />
                  )}
                  <input
                    className="border rounded p-1 mb-1"
                    placeholder="Placeholder"
                    value={field.placeholder}
                    onChange={e => updateField(field.id, { placeholder: e.target.value })}
                  />
                  <label className="mb-1">
                    <input
                      type="checkbox"
                      checked={field.required}
                      onChange={e => updateField(field.id, { required: e.target.checked })}
                    />{' '}
                    Required
                  </label>
                  <button
                    className="bg-red-600 text-white px-2 py-1 rounded self-start"
                    onClick={() => deleteField(field.id)}
                  >
                    Delete
                  </button>
                </div>
              ))}
            </div>

            <div className="flex gap-2 mt-4 flex-wrap">
              <button
                onClick={undo}
                disabled={past.length === 0}
                className={`px-4 py-2 rounded ${past.length === 0 ? 'bg-gray-400' : 'bg-yellow-500 hover:bg-yellow-600'}`}
              >
                Undo
              </button>
              <button
                onClick={redo}
                disabled={future.length === 0}
                className={`px-4 py-2 rounded ${future.length === 0 ? 'bg-gray-400' : 'bg-green-500 hover:bg-green-600'}`}
              >
                Redo
              </button>
              <button
                onClick={generateLink}
                className="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700"
              >
                Copy Shareable Link
              </button>
            </div>
            {copiedLink && <div className="copy-link-box">{copiedLink}</div>}
          </>
        )}

        {fields.length > 0 && (
          <form
            ref={formRef}
            className={`mt-8 p-6 rounded shadow form-preview ${templateClass}`}
            onSubmit={onSubmit}
          >
            {fields.map(field => {
              if (field.type === 'Text') {
                return (
                  <div key={field.id} className="mb-4">
                    <label className="block mb-1 font-semibold">{field.label}{field.required ? ' *' : ''}</label>
                    <input
                      type="text"
                      placeholder={field.placeholder}
                      required={field.required}
                      className="border rounded p-2 w-full"
                    />
                  </div>
                );
              }
              if (field.type === 'Textarea') {
                return (
                  <div key={field.id} className="mb-4">
                    <label className="block mb-1 font-semibold">{field.label}{field.required ? ' *' : ''}</label>
                    <textarea
                      placeholder={field.placeholder}
                      required={field.required}
                      className="border rounded p-2 w-full"
                    />
                  </div>
                );
              }
              if (field.type === 'Date') {
                return (
                  <div key={field.id} className="mb-4">
                    <label className="block mb-1 font-semibold">{field.label}{field.required ? ' *' : ''}</label>
                    <input
                      type="date"
                      required={field.required}
                      className="border rounded p-2 w-full"
                    />
                  </div>
                );
              }
              if (field.type === 'Dropdown') {
                return (
                  <div key={field.id} className="mb-4">
                    <label className="block mb-1 font-semibold">{field.label}{field.required ? ' *' : ''}</label>
                    <select
                      required={field.required}
                      className="border rounded p-2 w-full"
                    >
                      <option value="">Select...</option>
                      {(field.options || '').split(',').map((opt, i) => (
                        <option key={i} value={opt.trim()}>{opt.trim()}</option>
                      ))}
                    </select>
                  </div>
                );
              }
              if (field.type === 'Checkbox') {
                return (
                  <div key={field.id} className="mb-4 flex items-center gap-2">
                    <input
                      type="checkbox"
                      required={field.required}
                      id={`chk_${field.id}`}
                    />
                    <label htmlFor={`chk_${field.id}`} className="font-semibold">{field.label}</label>
                  </div>
                );
              }
              return null;
            })}
            <button
              type="submit"
              className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
            >
              Submit
            </button>
          </form>
        )}
      </div>
    );
  }

  ReactDOM.createRoot(document.getElementById('root')).render(<App />);

  document.getElementById('themeToggle').addEventListener('click', () => {
    const current = document.body.className;
    if (current === 'light') {
      document.body.className = 'dark';
      localStorage.setItem('theme', 'dark');
    } else {
      document.body.className = 'light';
      localStorage.setItem('theme', 'light');
    }
  });
</script>
</body>
</html>
